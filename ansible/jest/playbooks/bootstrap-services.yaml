- name: deploy services
  hosts: jest

  tasks:
    - name: setup service repository
      ansible.builtin.import_tasks: ../tasks/setup-service-repository.yaml

    - name: setup aws python SDK
      become: yes
      ansible.builtin.apt:
        name:
        - python3-botocore
        - python3-boto3

    - name: download service-data from S3
      ansible.builtin.import_tasks: ../tasks/download-service-data-s3.yaml

    - name: download service-secrets from S3
      ansible.builtin.import_tasks: ../tasks/download-service-secrets-s3.yaml

    - name: create external docker network for traefik
      become: yes
      community.docker.docker_network:
        name: services_traefik

    - name: configure & deploy services
      ansible.builtin.import_tasks: ../tasks/configure-deploy-services.yaml

    - name: configure & deploy Bitwarden
      ansible.builtin.import_tasks: ../tasks/configure-deploy-bitwarden.yaml
